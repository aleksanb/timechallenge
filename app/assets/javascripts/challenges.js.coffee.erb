# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/

$(document).ready ->
  $('.datepicker').pickadate()
  $('.timepicker').pickatime(
    interval: 15
  )

  $('#typeahead_building').typeahead(
    name: 'ime_buildings'
    prefetch:
      url: '/assets/ime_buildings.json'
      filter: (json_obj) ->
        for building in json_obj.buildings
          tokens: building.name.split ' '
          id: building.id
          value: building.name
  )
  .on 'keyup', ->
    $("#typeahead_room").val("")
  .on 'typeahead:autocompleted typeahead:selected', (e, building) =>
    @building = building

  $('#typeahead_room').typeahead(
    name: 'ime_rooms'
    remote:
      url: "http://www.ime.ntnu.no/api/fdv/rooms/"
      dataType: 'jsonp'
      replace: =>
        q = "http://www.ime.ntnu.no/api/fdv/rooms/"
        if @building.id?
          q += "buildingid:" + @building.id
        else
          return

      filter: (json_obj) ->
        for room in json_obj.rooms
          tokens: [room.type, room.name, room.nr]
          value: "#{room.nr} - #{room.type}"
  )
